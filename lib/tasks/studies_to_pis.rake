require 'file_utilities' #specific methods
require 'utilities' # was row_iterator and other methods
require 'app/helpers/format_helper'
include FormatHelper

require 'rubygems'

namespace :reports do
  study_list = ["STU00001460","STU00001522","STU00001576","STU00002540","STU00002669","STU00002961","STU00003049","STU00003419","STU00004428","STU00004555","STU00004868","STU00004896","STU00005142","STU00005421","STU00005511","STU00005771","STU00005786","STU00005867","STU00006092","STU00006366","STU00006644","STU00006877","STU00006994","STU00007087","STU00007099","STU00007312","STU00007508","STU00007570","STU00007790","STU00007877","STU00008001","STU00008096","STU00008511","STU00008716","STU00008779","STU00008802","STU00008996","STU00009011","STU00009016","STU00009126","STU00009193","STU00009301","STU00009325","STU00009332","STU00009417","STU00009603","STU00009604","STU00009658","STU00009935","STU00009950","STU00009959","STU00010003","STU00010076","STU00010205","STU00010241","STU00010457","STU00010501","STU00010974","STU00011311","STU00011640","STU00011815","STU00011825","STU00012048","STU00012266","STU00012379","STU00012467","STU00012633","STU00012729","STU00012731","STU00012732","STU00012770","STU00013031","STU00013247","STU00013264","STU00013313","STU00013435","STU00013577","STU00013763","STU00013928","STU00014001","STU00014242","STU00014244","STU00014564","STU00014598","STU00014777","STU00014821","STU00014911","STU00014943","STU00015568","STU00015581","STU00015601","STU00015649","STU00015746","STU00015755","STU00015791","STU00015874","STU00015954","STU00016120","STU00016454","STU00016533","STU00016535","STU00016537","STU00016614","STU00016833","STU00016917","STU00017005","STU00017031","STU00017061","STU00017234","STU00017296","STU00017560","STU00017640","STU00017938","STU00018011","STU00018244","STU00018616","STU00018644","STU00018651","STU00018967","STU00019012","STU00019137","STU00019450","STU00019555","STU00019685","STU00019743","STU00019758","STU00019804","STU00019833","STU00019879","STU00019956","STU00019991","STU00020072","STU00020161","STU00020619","STU00020815","STU00020824","STU00020827","STU00020973","STU00020989","STU00021135","STU00021190","STU00021282","STU00021287","STU00021294","STU00021507","STU00021811","STU00022034","STU00022264","STU00022288","STU00022341","STU00022489","STU00022942","STU00023135","STU00023169","STU00023645","STU00023843","STU00023907","STU00023921","STU00023946","STU00023955","STU00023972","STU00023986","STU00023999","STU00024243","STU00024421","STU00024664","STU00024718","STU00025184","STU00025294","STU00025418","STU00025451","STU00025466","STU00025581","STU00026007","STU00026024","STU00026028","STU00026095","STU00026200","STU00026255","STU00026342","STU00026786","STU00026896","STU00026995","STU00027057","STU00027354","STU00027473","STU00027497","STU00027508","STU00027683","STU00027688","STU00027808","STU00027887","STU00027914","STU00028019","STU00028036","STU00028041","STU00028061","STU00028773","STU00029383","STU00029464","STU00029486","STU00029680","STU00030066","STU00030096","STU00030121","STU00030417","STU00030833","STU00030888","STU00030974","STU00030993","STU00031038","STU00031398","STU00031497","STU00031693","STU00031907","STU00032008","STU00032173","STU00032316","STU00032317","STU00032893","STU00033010","STU00033365","STU00033689","STU00033794","STU00033978","STU00034167","STU00034255","STU00034384","STU00034563","STU00034773","STU00034850","STU00034950","STU00035113","STU00035518","STU00035945","STU00036427","STU00036458","STU00036629","STU00036866","STU00037055","STU00037281","STU00037287","STU00037288","STU00037740","STU00037913","STU00037945","STU00038010","STU00038049","STU00038127","STU00038152","STU00038207","STU00038230","STU00038787","STU00038803","STU00038909","STU00038911","STU00038944","STU00039195","STU00039808","STU00040288","STU00040420","STU00040874","STU00041030","STU00041538","STU00041716","STU00041938","STU00042189","STU00043110","STU00043779","STU00044115","STU00044731","STU00045203","STU00045270","STU00046379","STU00046406","STU00046732","STU00047146","STU00049271","STU00049304","STU00049395","STU00049623","STU00049624","STU00049710","STU00050068","STU00050349","STU00050475","STU00050728","STU00050741","STU00051008","STU00051080","STU00051344","STU00051357","STU00051862","STU00051933","STU00052052","STU00052502","STU00053046","STU00053271","STU00053472","STU00053736","STU00053737","STU00053822","STU00054908","STU00055193","STU00055233","STU00055959","STU00056026","STU00056087","STU00056190","STU00056214","STU00056269","STU00056732","STU00057172","STU00057336","STU00057775","STU00058702","STU00058740","STU00058889","STU00059112","STU00060873","STU00060914","STU00061074","STU00061627","STU00061633","STU00062143","STU00062365"]
  
  desc "useful for taking a list of netids and looking up in the FSM faculty database and resolving against LDAP"
  
  desc "useful for taking an investigator name and breaking into first_name, middle_name, last_name, suffix"
  task :studies_to_pi => :environment do
    puts "username\tname\tSTU\tirb_study_number\tStatus\tApproved date\tNext review date\tTitle"
    study_list.each do |stu|
      study = Study.find_by_irb_study_number(stu)
      if study.blank?
        puts "unable to find STU #{stu}"
      elsif study.pi.blank?
        puts "unable to find PI for #{stu}"
      else
        puts "#{study.pi.username}\t#{study.pi.name}\t#{stu}\t#{study.irb_study_number}\t#{study.status}\t#{study.approved_date}\t#{study.next_review_date}\t#{study.title.gsub(/[\r\n]+/,'')}"
      end
    end
  end

 
 end


